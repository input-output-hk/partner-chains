<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Pallet for setting the Partner Chain validators using inherent data"><title>pallet_session_validator_management - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Italic-81dc35de.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-MediumItalic-ccf7e434.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2"href="../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../static.files/rustdoc-ca0dd0c4.css"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="pallet_session_validator_management" data-themes="" data-resource-suffix="" data-rustdoc-version="1.92.0-nightly (4b94758d2 2025-10-13)" data-channel="nightly" data-search-js="search-8d3311b9.js" data-stringdex-js="stringdex-828709d0.js" data-settings-js="settings-c38705f0.js" ><script src="../static.files/storage-e2aeef58.js"></script><script defer src="../crates.js"></script><script defer src="../static.files/main-ce535bd0.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-263c88ec.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-eab170b8.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-044be391.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><rustdoc-topbar><h2><a href="#">Crate pallet_session_validator_management</a></h2></rustdoc-topbar><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../pallet_session_validator_management/index.html">pallet_<wbr>session_<wbr>validator_<wbr>management</a><span class="version">1.8.0</span></h2></div><div class="sidebar-elems"><ul class="block"><li><a id="all-types" href="all.html">All Items</a></li></ul><section id="rustdoc-toc"><h3><a href="#">Sections</a></h3><ul class="block top-toc"><li><a href="#purpose-of-the-pallet" title="Purpose of the pallet">Purpose of the pallet</a></li><li><a href="#committee-selection-overview" title="Committee selection overview">Committee selection overview</a></li><li><a href="#observability-parameters" title="Observability parameters">Observability parameters</a></li><li><a href="#usage" title="Usage">Usage</a><ul><li><a href="#prerequisites" title="Prerequisites">Prerequisites</a></li><li><a href="#adding-into-the-runtime" title="Adding into the runtime">Adding into the runtime</a></li><li><a href="#genesis-configuration" title="Genesis configuration">Genesis configuration</a></li><li><a href="#updating-pallet-configuration" title="Updating pallet configuration">Updating pallet configuration</a></li></ul></li></ul><h3><a href="#reexports">Crate Items</a></h3><ul class="block"><li><a href="#reexports" title="Re-exports">Re-exports</a></li><li><a href="#modules" title="Modules">Modules</a></li><li><a href="#enums" title="Enums">Enums</a></li><li><a href="#traits" title="Traits">Traits</a></li></ul></section><div id="rustdoc-modnav"></div></div></nav><div class="sidebar-resizer" title="Drag to resize sidebar"></div><main><div class="width-limiter"><section id="main-content" class="content"><div class="main-heading"><h1>Crate <span>pallet_<wbr>session_<wbr>validator_<wbr>management</span>&nbsp;<button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../src/pallet_session_validator_management/lib.rs.html#1-697">Source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Pallet for setting the Partner Chain validators using inherent data</p>
<h2 id="purpose-of-the-pallet"><a class="doc-anchor" href="#purpose-of-the-pallet">§</a>Purpose of the pallet</h2>
<p>This pallet provides a mechanism to rotate Partner Chain’s block producing committees
based on candidate registrations and chain configuration sourced from Cardano. It works
by integrating with <code>pallet_session</code> as a <a href="pallet_session::SessionManager">SessionManager</a> and [ShouldEndSession] to provide it
with committee information and to rotate sessions. In addition to managing the sessions,
the pallet automatically registers session keys of all active block producers, alleviating
the need for manual key registration, and ensures that all necessary chain-local accounts
exist.</p>
<h2 id="committee-selection-overview"><a class="doc-anchor" href="#committee-selection-overview">§</a>Committee selection overview</h2>
<p>Committees are selected for sessions corresponding roughly to Partner Chain epochs, whose
duration is configurable for each Partner Chain. Due to the way session rotation works in
<code>pallet_session</code>, these sessions are delayed by <em>2 blocks</em> relative to their respective
epoch.</p>
<p>Committees are selected based on the following inputs sourced from Cardano:</p>
<ul>
<li><code>Registered candidates</code>:
Cardano SPOs who have registered themselves as willing to participate as block producers.
These candidates need to control an ADA stake pool to be eligible for selection to a
committee, and their chance at securing a seat is proportional to their pool’s size.
This candidate group corresponds to a typical “trustless” Proof of Stake block producers.</li>
<li><code>Permissioned candidates</code>:
A list of trusted block producers that do not need to register themselves or control any
ADA stake on Cardano to be eligible for a Partner Chain committee.
This candidate group serves a special role as trusted block producers during initial phase
of a Partner Chain’s lifetime (when there may not be enough registered candidates to ensure
proper security and decentralization of the network), and are intended to be phased out as
the number of trustless participants grows.</li>
<li><code>D-Parameter</code>:
A pair of two values <code>R</code> and <code>P</code>, controlling the number of committee seats alloted for
registered and permissioned candidates respectively, which means that a committee has R+P
seats overall. This parameter gives the Partner Chain the ability to bootstrap itself using
an initial pool of permissioned candidates running trusted nodes, and then gradually shift
to registered (trustless) candidates when proper decentralization is achieved</li>
<li><code>randomness seed</code>:
All randomness when selecting the committee is seeded from data sourced from Cardano so that
it is tamper-proof and agreed upon by all nodes.</li>
</ul>
<p>The permissioned candidate list and the D-Parameter are controlled by the Partner Chain’s
governance authority and are crucial in ensuring the chain’s security in initial phases of
its existence</p>
<h2 id="observability-parameters"><a class="doc-anchor" href="#observability-parameters">§</a>Observability parameters</h2>
<p>All input data used when selecting a committee of a Partner Chain is sourced from Cardano.
To correctly identify it, each node needs access to the current values of:</p>
<ul>
<li><code>the registration validator address</code>, at which all registration UTXOs are located</li>
<li><code>the D-Parameter minting policy</code>, whose tokens mark the UTXO containing D-Parameter value</li>
<li><code>the permissioned candidate minting policy</code>, whose tokens mark the UTXO containing the
permissioned candidate list</li>
</ul>
<p>These values are stored in the pallet storage, ensuring that they’re available for all nodes
to use and agreed upon through the consensus mechanism, and can be updated using a governance
level extrinsic [set_main_chain_scripts].</p>
<h2 id="usage"><a class="doc-anchor" href="#usage">§</a>Usage</h2><h3 id="prerequisites"><a class="doc-anchor" href="#prerequisites">§</a>Prerequisites</h3>
<p>This pallet’s operation requires the appropriate inherent data provider and data source
be present in the node. As this pallet is crucial for the operation of the chain itself,
these must be present before at the chain start or before the pallet is migrated to, to
avoid down time. See documentation of <code>sp_session_validator_management</code> for information
on how to add the IDP to your node. A Db-Sync-based data source implementation is provided
by the <code>partner_chains_db_sync_data_sources</code> crate.</p>
<p>Aside from the node components, the pallet requires the Partner Chain smart contracts to
have been initialized on Cardano and that at least one candidate - either a registered or
permissioned one - exists. See <code>docs/user-guides/governance/governance.md</code> and
<code>docs/user-guides/chain-builder.md</code> for more information about governance and how to set
up the Partner Chain on Cardano.</p>
<h3 id="adding-into-the-runtime"><a class="doc-anchor" href="#adding-into-the-runtime">§</a>Adding into the runtime</h3><h4 id="defining-key-types"><a class="doc-anchor" href="#defining-key-types">§</a>Defining key types</h4>
<p>As with a stock Substrate chain, a Partner Chain needs to define its session keys. What
these keys are depends on the consensus mechanisms used by the chain. For a Partner Chain
using Aura as its consensus with a Grandpa finality gadget, the session keys can be defined
as following:</p>

<div class="example-wrap ignore"><a href="#" class="tooltip" title="This example is not tested">ⓘ</a><pre class="rust rust-example-rendered"><code><span class="macro">sp_runtime::impl_opaque_keys!</span> {
	<span class="attr">#[derive(MaxEncodedLen, PartialOrd, Ord)]
	</span><span class="kw">pub struct </span>SessionKeys {
		<span class="kw">pub </span>aura: Aura
		<span class="kw">pub </span>grandpa: Grandpa,
	}
}</code></pre></div>
<p>In addition to the session keys, the runtime needs to define an ECDSA key type to represent
the <code>cross-chain key</code>:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">pub mod </span>cross_chain_app {
    <span class="kw">use </span>sp_runtime::KeyTypeId;
    <span class="kw">use </span>sp_runtime::app_crypto::{ app_crypto, ecdsa };
    <span class="kw">pub const </span>CROSS_CHAIN: KeyTypeId = KeyTypeId(<span class="kw-2">*</span><span class="string">b"crch"</span>);
	<span class="macro">app_crypto!</span>(ecdsa, CROSS_CHAIN);
}
<span class="kw">pub type </span>CrossChainPublic = cross_chain_app::Public;</code></pre></div>
<p>This key serves as the identity of a Partner Chain user across all chains in the ecosystem.</p>
<h4 id="adding-the-pallet"><a class="doc-anchor" href="#adding-the-pallet">§</a>Adding the pallet</h4>
<p>The pallet should be added to the runtime <em>before</em> <code>pallet_session</code>, but after the consensus
pallets used by the chain:</p>

<div class="example-wrap ignore"><a href="#" class="tooltip" title="This example is not tested">ⓘ</a><pre class="rust rust-example-rendered"><code><span class="macro">construct_runtime!</span>(
	<span class="kw">pub struct </span>Runtime {
		System: frame_system,
		Timestamp: pallet_timestamp,
		Aura: pallet_aura,
		Grandpa: pallet_grandpa,
		Sidechain: pallet_sidechain,
		SessionCommitteeManagement: pallet_session_validator_management,
		Session: pallet_session exclude_parts { Call },
        <span class="comment">// ... other pallets
	</span>}
);</code></pre></div>
<p><em>Important</em>:
It is recommended that when <code>pallet_session</code> is wired into the runtime, its extrinsics are
hidden, using <code>exclude_parts</code> like in the example above. This ensures that chain users can’t
manually register their keys in the pallet and so the registrations done on Cardano remain
the sole source of truth about key ownership. Proper operation in presence of manually set
user keys is not guaranteed by the toolkit and its behavior is left unspecified.</p>
<h4 id="configuring-the-pallet"><a class="doc-anchor" href="#configuring-the-pallet">§</a>Configuring the pallet</h4>
<p>Configuring the pallet is straightforward and mostly consists of passing to it types already
defined by other crates and in previous steps:</p>

<div class="example-wrap ignore"><a href="#" class="tooltip" title="This example is not tested">ⓘ</a><pre class="rust rust-example-rendered"><code><span class="kw">impl </span>pallet_session_validator_management::Config <span class="kw">for </span>Runtime {
	<span class="kw">type </span>MaxValidators = MaxValidators;
	<span class="kw">type </span>AuthorityId = CrossChainPublic;
	<span class="kw">type </span>AuthorityKeys = SessionKeys;
	<span class="kw">type </span>AuthoritySelectionInputs = authority_selection_inherents::AuthoritySelectionInputs;
	<span class="kw">type </span>ScEpochNumber = sidechain_domain::ScEpochNumber;
	<span class="kw">type </span>WeightInfo = pallet_session_validator_management::weights::SubstrateWeight&lt;Runtime&gt;;
	<span class="kw">type </span>CommitteeMember = authority_selection_inherents::CommitteeMember&lt;CrossChainPublic, SessionKeys&gt;;
	<span class="kw">type </span>MainChainScriptsOrigin = EnsureRoot&lt;<span class="self">Self</span>::AccountId&gt;;

	<span class="kw">fn </span>select_authorities(
		input: AuthoritySelectionInputs,
		sidechain_epoch: ScEpochNumber,
	) -&gt; <span class="prelude-ty">Option</span>&lt;BoundedVec&lt;<span class="self">Self</span>::CommitteeMember, <span class="self">Self</span>::MaxValidators&gt;&gt; {
		authority_selection_inherents::select_authorities::&lt;CrossChainPublic, SessionKeys, MaxValidators&gt;(
			Sidechain::genesis_utxo(),
			input,
			sidechain_epoch,
		)
	}

	<span class="kw">fn </span>current_epoch_number() -&gt; ScEpochNumber {
		Sidechain::current_epoch_number()
	}
}</code></pre></div>
<p>One value that needs to be decided upon by the chain builder is <code>MaxValidators</code> which dictates
the maximum size of a committee. This value should be higher than the P + R of the D-Parameter
used and should be adjusted accordingly before any D-Parameter changes that would exceed the
previous value. In case a committee selected is bigger than <code>MaxValidators</code>, it will be truncated,
potentially leading to a skewed seat allocation and threatening the security of the consensus.</p>
<h3 id="genesis-configuration"><a class="doc-anchor" href="#genesis-configuration">§</a>Genesis configuration</h3>
<p>Genesis config can be created programmatically:</p>

<div class="example-wrap ignore"><a href="#" class="tooltip" title="This example is not tested">ⓘ</a><pre class="rust rust-example-rendered"><code>GenesisConfig {
	initial_authorities: <span class="macro">vec!</span>[
       CommitteeMember::permissioned(cross_chain_pubkey_1, session_keys_1),
    ],
	main_chain_scripts: MainChainScripts::read_from_env()<span class="question-mark">?</span>,
}</code></pre></div>
<p>However, it is more typical for production chains to define their specs using Json. In that case
an example configuration could look like this:</p>
<div class="example-wrap"><pre class="language-json"><code>{
  &quot;initialAuthorities&quot;: [
    {
      &quot;Permissioned&quot;: {
        &quot;id&quot;: &quot;KW39r9CJjAVzmkf9zQ4YDb2hqfAVGdRqn53eRqyruqpxAP5YL&quot;,
        &quot;keys&quot;: {
          &quot;aura&quot;: &quot;5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY&quot;,
          &quot;grandpa&quot;: &quot;5FA9nQDVg267DEd8m1ZypXLBnvN7SFxYwV7ndqSYGiN9TTpu&quot;
        }
      }
    }
  ],
  &quot;mainChainScripts&quot;: {
    &quot;committee_candidate_address&quot;: &quot;addr_test1wrp8p2c5h7encl55gv26d5fpz9r99jxjcm0rxgny3993dxs2xy42p&quot;,
    &quot;d_parameter_policy_id&quot;: &quot;0x434dc797fd036b0b654c005551ec08f39d25fa7f0eecdf4b170d46cf&quot;,
    &quot;permissioned_candidates_policy_id&quot;: &quot;0xe1ce5d1b8b3e93a7493ecc11556790f915aabbc44a56b0b5145770b2&quot;
  }
}</code></pre></div>
<p><em>Important</em>:
Notice, that since the pallet’s operation is necessary for block production, all main chain script
values and at least one initial authority (block producer) must be provided by the genesis config.</p>
<h3 id="updating-pallet-configuration"><a class="doc-anchor" href="#updating-pallet-configuration">§</a>Updating pallet configuration</h3><h4 id="maxvalidators"><a class="doc-anchor" href="#maxvalidators">§</a>MaxValidators</h4>
<p>The maximum number of committee seats. As this value is not typically expected to change, it is
configured as part of the pallet’s <a href="pallet/trait.Config.html" title="trait pallet_session_validator_management::pallet::Config">Config</a>. This means that it can only be updated as part of a
runtime upgrade. The chain builder should release a new runtime version with this value updated
and the Partner Chain’s governance mechanism should be used to apply it using <a href="frame_system::Pallet::set_code">set_code</a>.</p>
<h4 id="main-chain-scripts"><a class="doc-anchor" href="#main-chain-scripts">§</a>Main chain scripts</h4>
<p>The main chain scripts can change over time as the Partner Chain migrates to new versions of the
Partner Chain smart contracts, either due to bug fixes or new features being released. This is
necessary, because the script addresses are derived by hashing their Plutus code and are affected
by any change made to it.</p>
<p>The scripts are updated by invoking the [set_main_chain_scripts] extrinsic using the Partner Chain’s
governance mechanism.</p>
<p><em>Important</em>: Setting incorrect main chain script values will result in stalling block production
indefinitely, requiring a network-wide roll-back. As such, main chain scripts update
should be carried out with special care.</p>
</div></details><h2 id="reexports" class="section-header">Re-exports<a href="#reexports" class="anchor">§</a></h2><dl class="item-table reexports"><dt id="reexport.WeightInfo"><code>pub use weights::<a class="trait" href="weights/trait.WeightInfo.html" title="trait pallet_session_validator_management::weights::WeightInfo">WeightInfo</a>;</code></dt><dt><code>pub use <a class="mod" href="pallet/index.html" title="mod pallet_session_validator_management::pallet">pallet</a>::*;</code></dt></dl><h2 id="modules" class="section-header">Modules<a href="#modules" class="anchor">§</a></h2><dl class="item-table"><dt><a class="mod" href="migrations/index.html" title="mod pallet_session_validator_management::migrations">migrations</a></dt><dd>Implements storage migrations of <code>pallet-session-validator-management</code>.</dd><dt><a class="mod" href="pallet/index.html" title="mod pallet_session_validator_management::pallet">pallet</a></dt><dd>The <code>pallet</code> module in each FRAME pallet hosts the most important items needed
to construct this pallet.</dd><dt><a class="mod" href="pallet_session_support/index.html" title="mod pallet_session_validator_management::pallet_session_support">pallet_<wbr>session_<wbr>support</a></dt><dd>[<code>pallet_session</code>] integration.
Implements [pallet_session::SessionManager] and [pallet_session::ShouldEndSession] for <a href="pallet/struct.Pallet.html" title="struct pallet_session_validator_management::pallet::Pallet">crate::Pallet</a>.</dd><dt><a class="mod" href="weights/index.html" title="mod pallet_session_validator_management::weights">weights</a></dt><dd>Autogenerated weights for pallet_session_validator_management</dd></dl><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">§</a></h2><dl class="item-table"><dt><a class="enum" href="enum.CommitteeRotationStages.html" title="enum pallet_session_validator_management::CommitteeRotationStages">Committee<wbr>Rotation<wbr>Stages</a></dt><dd>For session state machine</dd></dl><h2 id="traits" class="section-header">Traits<a href="#traits" class="anchor">§</a></h2><dl class="item-table"><dt><a class="trait" href="trait.CommitteeMember.html" title="trait pallet_session_validator_management::CommitteeMember">Committee<wbr>Member</a></dt><dd>Signifies that a type represents a committee member</dd></dl></section></div></main></body></html>