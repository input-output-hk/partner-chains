<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Pallet exposing key-value pairs sourced from the Cardano ledger as part of the Governed Map feature."><title>pallet_governed_map - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Italic-81dc35de.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-MediumItalic-ccf7e434.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../static.files/rustdoc-1a91846b.css"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="pallet_governed_map" data-themes="" data-resource-suffix="" data-rustdoc-version="1.88.0-nightly (27d6200a7 2025-05-06)" data-channel="nightly" data-search-js="search-f7877310.js" data-settings-js="settings-5514c975.js" ><script src="../static.files/storage-4e99c027.js"></script><script defer src="../crates.js"></script><script defer src="../static.files/main-7ef8a74a.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-893ab5e7.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-6580c154.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-044be391.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../pallet_governed_map/index.html">pallet_<wbr>governed_<wbr>map</a><span class="version">1.6.0</span></h2></div><div class="sidebar-elems"><ul class="block"><li><a id="all-types" href="all.html">All Items</a></li></ul><section id="rustdoc-toc"><h3><a href="#">Sections</a></h3><ul class="block top-toc"><li><a href="#purpose-of-this-pallet" title="Purpose of this pallet">Purpose of this pallet</a></li><li><a href="#usage" title="Usage">Usage</a><ul><li><a href="#adding-to-runtime" title="Adding to runtime">Adding to runtime</a></li><li><a href="#updating-main-chain-scripts" title="Updating main chain scripts">Updating main chain scripts</a></li></ul></li></ul><h3><a href="#modules">Crate Items</a></h3><ul class="block"><li><a href="#modules" title="Modules">Modules</a></li><li><a href="#structs" title="Structs">Structs</a></li></ul></section><div id="rustdoc-modnav"></div></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><h1>Crate <span>pallet_governed_map</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../src/pallet_governed_map/lib.rs.html#1-395">Source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Pallet exposing key-value pairs sourced from the Cardano ledger as part of the Governed Map feature.</p>
<h2 id="purpose-of-this-pallet"><a class="doc-anchor" href="#purpose-of-this-pallet">§</a>Purpose of this pallet</h2>
<p>This pallet stores the most recent state of the key-value pairs in the Governed Map on Cardano for use
by other runtime components. It also exposes hooks for other components to be notified when particular
key-value pair is inserted, updated or deleted.</p>
<h2 id="usage"><a class="doc-anchor" href="#usage">§</a>Usage</h2><h3 id="adding-to-runtime"><a class="doc-anchor" href="#adding-to-runtime">§</a>Adding to runtime</h3><h4 id="defining-size-limits"><a class="doc-anchor" href="#defining-size-limits">§</a>Defining size limits</h4>
<p>Before adding the pallet to your runtime, first decide on the limits for the data that it will process:</p>
<h5 id="maxchanges"><a class="doc-anchor" href="#maxchanges">§</a><code>MaxChanges</code></h5>
<p>The maximum number of changes that will be processed in one inherent invocation. Changes
are understood as the diff between previously stored mappings and the currently observed
ones, as opposed to raw on-chain events altering those mappings.</p>
<p><strong>Important</strong>: This number must be high enough to guarantee the inherent will always have
the capacity required to process incoming changes. If the number of changes exceeds this
limit, [TooManyChanges][InherentError::TooManyChanges] error will be raised stalling block production.</p>
<p>If this error occurs on a live chain, then the only way of fixing it is to change the
mappings on Cardano close enough to the last state registered in the pallet to bring the
change count below the limit.
Setting this limit above the expected number of keys in use is a safe option.</p>
<h5 id="maxkeylength"><a class="doc-anchor" href="#maxkeylength">§</a><code>MaxKeyLength</code></h5>
<p>maximum length of keys that can be used.</p>
<p>Important: If a key is set in the Governed Map that exceeds this lenght limit, the
[KeyExceedsBounds][InherentError::KeyExceedsBounds] error will be raised stalling block production, with
the only recovery path being removal of this key so it is no longer in the change set.</p>
<h5 id="maxvaluelength"><a class="doc-anchor" href="#maxvaluelength">§</a><code>MaxValueLength</code></h5>
<p>Maximum length of the value under a key. Same considerations as for <code>MaxKeyLength</code> apply.</p>
<h5 id="defining-the-values-in-the-code"><a class="doc-anchor" href="#defining-the-values-in-the-code">§</a>Defining the values in the code</h5>
<p>Once the limit values are decided, define them in your runtime, like so:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="macro">frame_support::parameter_types!</span> {
       <span class="kw">pub const </span>MaxChanges: u32 = <span class="number">16</span>;
       <span class="kw">pub const </span>MaxKeyLength: u32 = <span class="number">64</span>;
       <span class="kw">pub const </span>MaxValueLength: u32 = <span class="number">512</span>;
}</code></pre></div>
<p>If at any point a need arises to either support higher volume of parameter changes or increase the maximum
length of keys and values in the mappings, it can be achieved through a runtime upgrade that modifies the
pallet’s configuration.</p>
<h4 id="implementing-on-change-handler"><a class="doc-anchor" href="#implementing-on-change-handler">§</a>Implementing on-change handler</h4>
<p>The pallet allows the runtime implementer to define a handler that will be called for all key-value
changes registered by the pallet. If your runtime needs to react to changes, crate a type implementing
the [OnGovernedMappingChange] trait, eg:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">struct </span>ChangeHandler;

<span class="kw">impl</span>&lt;MaxKeyLength, MaxValueLength&gt; sp_governed_map::OnGovernedMappingChange&lt;MaxKeyLength, MaxValueLength&gt; <span class="kw">for </span>ChangeHandler
<span class="kw">where
   </span>MaxKeyLength: Get&lt;u32&gt;,
   MaxValueLength: Get&lt;u32&gt;,
{
   <span class="kw">fn </span>on_governed_mapping_change(
       key: BoundedString&lt;MaxKeyLength&gt;,
       new_value: <span class="prelude-ty">Option</span>&lt;BoundedVec&lt;u8, MaxValueLength&gt;&gt;,
       old_value: <span class="prelude-ty">Option</span>&lt;BoundedVec&lt;u8, MaxValueLength&gt;&gt;,
   ) {
       <span class="macro">log::info!</span>(<span class="string">"Governed Map change for key {key}: old value: {old_value:?}, new value: {new_value:?}"</span>);
   }
}</code></pre></div>
<p>If any handling is not needed, a no-op implementation for [()] can be used instead.</p>
<h4 id="weights-and-benchmarking"><a class="doc-anchor" href="#weights-and-benchmarking">§</a>Weights and Benchmarking</h4>
<p>The pallet comes with pre-defined weights for its extrinsics that can be used during initial development
through the <a href="weights/struct.SubstrateWeight.html" title="struct pallet_governed_map::weights::SubstrateWeight">SubstrateWeight</a> type.</p>
<p>However, since data size limits and the on-change logic both can affect the weights, it is advisable to run
your own benchmark to account for their impact. See the documentation on [crate::benchmarking] for details.</p>
<h4 id="configuring-the-pallet"><a class="doc-anchor" href="#configuring-the-pallet">§</a>Configuring the pallet</h4>
<p>Once the above are defined, the pallet can finally be added to the runtime and configured like this:</p>

<div class="example-wrap ignore"><a href="#" class="tooltip" title="This example is not tested">ⓘ</a><pre class="rust rust-example-rendered"><code><span class="kw">impl </span>pallet_governed_map::Config <span class="kw">for </span>Runtime {
    <span class="kw">type </span>MaxChanges = MaxChanges;
    <span class="kw">type </span>MaxKeyLength = MaxKeyLength;
    <span class="kw">type </span>MaxValueLength = MaxValueLength;
    <span class="kw">type </span>WeightInfo = pallet_governed_map::weights::SubstrateWeight&lt;Runtime&gt;;

    <span class="kw">type </span>OnGovernedMappingChange = ChangeHandler;

    <span class="attr">#[cfg(feature = <span class="string">"runtime-benchmarks"</span>)]
    </span><span class="kw">type </span>BenchmarkHelper = ();
}</code></pre></div>
<h4 id="setting-the-main-chain-scripts"><a class="doc-anchor" href="#setting-the-main-chain-scripts">§</a>Setting the main chain scripts</h4>
<p>For the data sources to be able to observe the Governed Map state on Cardano, the pallet stores and exposes
relevant addresses and script hashes which are necessary to query main chain state. Their values need to be
set before the feature can be fully functional. How this is done depends on whether the pallet is present from
the genesis block or added later to a live chain.</p>
<h5 id="configuring-the-addresses-at-genesis"><a class="doc-anchor" href="#configuring-the-addresses-at-genesis">§</a>Configuring the addresses at genesis</h5>
<p>If the pallet is included in the runtime from genesis block, the scripts can be configured in the genesis config
of your runtime:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code>pallet_governed_map::GenesisConfig {
    main_chain_scripts: <span class="prelude-val">Some</span>(pallet_governed_map::MainChainScriptsV1 {
        asset_policy_id: PolicyId::from_hex_unsafe(<span class="string">"00000000000000000000000000000000000000000000000000000001"</span>),
        validator_address: MainchainAddress::from_str(<span class="string">"test_addr1"</span>).unwrap(),
    }),
    ..Default::default()
}</code></pre></div>
<p>At the same time <code>main_chain_scripts</code> field is optional and can be set to <a href="https://doc.rust-lang.org/nightly/core/option/enum.Option.html#variant.None" title="variant core::option::Option::None">None</a> if you wish to postpone setting
the scripts for whatever reason.</p>
<h5 id="setting-the-addresses-via-extrinsic"><a class="doc-anchor" href="#setting-the-addresses-via-extrinsic">§</a>Setting the addresses via extrinsic</h5>
<p>If the pallet is added to a running chain, it will initailly have no main chain scripts set and remain inactive
until they are set. See section “Updating main chain scripts” for more information.</p>
<h3 id="updating-main-chain-scripts"><a class="doc-anchor" href="#updating-main-chain-scripts">§</a>Updating main chain scripts</h3>
<p>To allow the Partner Chain’s governance to set and update main chain script values, the pallet provides the
<a href="pallet/enum.Call.html#variant.set_main_chain_scripts" title="variant pallet_governed_map::pallet::Call::set_main_chain_scripts">set_main_chain_scripts</a> extrinsic which updates the script values in its storage.
This extrinsic is required to be run with root access either via the <code>sudo</code> pallet or other governance mechanism.</p>
<p>Every time <a href="pallet/enum.Call.html#variant.set_main_chain_scripts" title="variant pallet_governed_map::pallet::Call::set_main_chain_scripts">set_main_chain_scripts</a> is successfuly invoked, the pallet will update
its tracked Governed Map state to be congruent with the mappings pointed to by the updates scripts on the next
Partner Chain block.</p>
</div></details><h2 id="reexports" class="section-header">Re-exports<a href="#reexports" class="anchor">§</a></h2><dl class="item-table reexports"><dt><code>pub use <a class="mod" href="pallet/index.html" title="mod pallet_governed_map::pallet">pallet</a>::*;</code></dt></dl><h2 id="modules" class="section-header">Modules<a href="#modules" class="anchor">§</a></h2><dl class="item-table"><dt><a class="mod" href="pallet/index.html" title="mod pallet_governed_map::pallet">pallet</a></dt><dd>The <code>pallet</code> module in each FRAME pallet hosts the most important items needed
to construct this pallet.</dd><dt><a class="mod" href="weights/index.html" title="mod pallet_governed_map::weights">weights</a></dt><dd>Autogenerated weights for pallet_governed_map</dd></dl><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><dl class="item-table"><dt><a class="struct" href="struct.MainChainScriptsV1.html" title="struct pallet_governed_map::MainChainScriptsV1">Main<wbr>Chain<wbr>Scripts<wbr>V1</a></dt><dd>Cardano identifiers necessary for observation of the Governed Map</dd></dl><script type="text/json" id="notable-traits-data">{"&'static [u8]":"<h3>Notable traits for <code>&amp;[<a class=\"primitive\" href=\"https://doc.rust-lang.org/nightly/std/primitive.u8.html\">u8</a>]</code></h3><pre><code><div class=\"where\">impl <a class=\"trait\" href=\"https://doc.rust-lang.org/nightly/std/io/trait.Read.html\" title=\"trait std::io::Read\">Read</a> for &amp;[<a class=\"primitive\" href=\"https://doc.rust-lang.org/nightly/std/primitive.u8.html\">u8</a>]</div>","Vec<u8>":"<h3>Notable traits for <code><a class=\"struct\" href=\"https://doc.rust-lang.org/nightly/alloc/vec/struct.Vec.html\" title=\"struct alloc::vec::Vec\">Vec</a>&lt;<a class=\"primitive\" href=\"https://doc.rust-lang.org/nightly/std/primitive.u8.html\">u8</a>, A&gt;</code></h3><pre><code><div class=\"where\">impl&lt;A&gt; <a class=\"trait\" href=\"https://doc.rust-lang.org/nightly/std/io/trait.Write.html\" title=\"trait std::io::Write\">Write</a> for <a class=\"struct\" href=\"https://doc.rust-lang.org/nightly/alloc/vec/struct.Vec.html\" title=\"struct alloc::vec::Vec\">Vec</a>&lt;<a class=\"primitive\" href=\"https://doc.rust-lang.org/nightly/std/primitive.u8.html\">u8</a>, A&gt;<div class=\"where\">where\n    A: <a class=\"trait\" href=\"https://doc.rust-lang.org/nightly/core/alloc/trait.Allocator.html\" title=\"trait core::alloc::Allocator\">Allocator</a>,</div></div>"}</script></section></div></main></body></html>