<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="A Substrate pallet maintaining a consumable log of block production information."><title>pallet_block_production_log - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-c5d6553a23f1e5a6.css"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="pallet_block_production_log" data-themes="" data-resource-suffix="" data-rustdoc-version="1.81.0 (eeb90cda1 2024-09-04)" data-channel="1.81.0" data-search-js="search-d234aafac6c221dd.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../static.files/storage-118b08c4c78b968e.js"></script><script defer src="../crates.js"></script><script defer src="../static.files/main-d2fab2bf619172d3.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-df360f571f6edeae.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../pallet_block_production_log/index.html">pallet_block_production_log</a><span class="version">1.6.0</span></h2></div><div class="sidebar-elems"><ul class="block"><li><a id="all-types" href="all.html">All Items</a></li></ul><section><ul class="block"><li><a href="#reexports">Re-exports</a></li><li><a href="#modules">Modules</a></li></ul></section></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><h1>Crate <a class="mod" href="#">pallet_block_production_log</a><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><span class="out-of-band"><a class="src" href="../src/pallet_block_production_log/lib.rs.html#1-231">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>A Substrate pallet maintaining a consumable log of block production information.</p>
<h3 id="purpose-of-this-pallet"><a class="doc-anchor" href="#purpose-of-this-pallet">§</a>Purpose of this pallet</h3>
<p>This pallet keeps a log containing block producer IDs along with slot numbers of blocks produced by them.
This log is updated every block and is meant to consumed by other features.
The intended use of this pallet within the Partner Chains SDK is to expose block production data for consumption
by the Block Participation feature implemented by the <code>sp_block_participation</code> and <code>pallet_block_participation</code>
crates.</p>
<h3 id="usage---pc-builder"><a class="doc-anchor" href="#usage---pc-builder">§</a>Usage - PC Builder</h3>
<p>This pallet requires inherent data provided by the inherent data provider defined by <code>sp_block_producerion_log</code>
crate. Consult the crate’s documentation for instruction on how to wire it into the node correctly.</p>
<h4 id="adding-to-the-runtime"><a class="doc-anchor" href="#adding-to-the-runtime">§</a>Adding to the runtime</h4>
<p>The pallet requires a minimal configuration. Consult the documentation for <a href="pallet/trait.Config.html" title="trait pallet_block_production_log::pallet::Config">pallet::Config</a> for details.</p>
<p>An example configuration for a runtime using Aura consensus might look like this:</p>

<div class="example-wrap ignore"><a href="#" class="tooltip" title="This example is not tested">ⓘ</a><pre class="rust rust-example-rendered"><code><span class="kw">impl </span>pallet_block_production_log::Config <span class="kw">for </span>Runtime {
    <span class="kw">type </span>BlockProducerId = BlockAuthor;
    <span class="kw">type </span>WeightInfo = pallet_block_production_log::weights::SubstrateWeight&lt;Runtime&gt;;

    <span class="kw">fn </span>current_slot() -&gt; sp_consensus_slots::Slot {
        <span class="kw">let </span>slot: u64 = pallet_aura::CurrentSlot::&lt;Runtime&gt;::get().into();
        sp_consensus_slots::Slot::from(slot)
    }

    <span class="attr">#[cfg(feature = <span class="string">"runtime-benchmarks"</span>)]
    </span><span class="kw">type </span>BenchmarkHelper = PalletBlockProductionLogBenchmarkHelper;
}</code></pre></div>
<h5 id="defining-block-producer-id"><a class="doc-anchor" href="#defining-block-producer-id">§</a>Defining block producer ID</h5>
<p>The pallet expects the Partner Chain to provide a type representing its block producers.
This type can be as simple as an Aura public key but can also be a more complex type if block producers
are not a homogenous group. For example, in the context of a Partner Chain using Ariadne committee selection,
it’s typical to have two kinds of block producers: permissioned producers provided by the governance authority
and registered candidates recruited from among Cardano stake pool operators. In this instance an example
author type could be:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>sidechain_domain::<span class="kw-2">*</span>;

<span class="kw">pub enum </span>BlockAuthor {
    Incentivized(CrossChainPublicKey, StakePoolPublicKey),
    ProBono(CrossChainPublicKey),
}</code></pre></div>
<p>Keep in mind that other Partner Chains SDK components put their own constraints on the block author type
that need to be adhered to for a Partner Chain to integrated them.</p>
<h5 id="support-for-adding-to-a-running-chain"><a class="doc-anchor" href="#support-for-adding-to-a-running-chain">§</a>Support for adding to a running chain</h5>
<p>The pallet and its inherent data provider defined in [sp_block_production_log] are written in a way that allows for
adding it to an already live chain. The pallet allows for an initial period where inherent data is unavailable
and considers its inherent extrinsic required only after the first block where inherent data is provided.
Conversely, the inherent data provider is active only when the pallet and its runtime API is present for it to call.</p>
<h4 id="consuming-the-log"><a class="doc-anchor" href="#consuming-the-log">§</a>Consuming the log</h4>
<p><strong>Important</strong>: Consuming the log is a destructive operation. Multiple features should not consume the log data
unless they are coordinated to read and clear the same log prefix.</p>
<p>The pallet exposes three functions that allow other pallets to consume its data: <code>take_prefix</code>, <code>peek_prefix</code>
and <code>drop_prefix</code>. Any feature using the log should be able to identify the slot number up to which it should
process the log data and either:</p>
<ul>
<li>call <code>take_prefix</code> from some pallet’s logic and process the returned data within the same block</li>
<li>call <code>peek_prefix</code> inside an inherent data provider and use <code>drop_prefix</code> from the corresponding pallet
to clear the previously peeked data within the same block</li>
</ul>
<p>It is critically important to drop exactly the prefix processed to avoid either skipping or double-counting some blocks.</p>
<h3 id="usage---pc-user"><a class="doc-anchor" href="#usage---pc-user">§</a>Usage - PC user</h3>
<p>This pallet does not expose any user-facing functionalities.</p>
</div></details><h2 id="reexports" class="section-header">Re-exports<a href="#reexports" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name" id="reexport.WeightInfo"><code>pub use weights::<a class="trait" href="weights/trait.WeightInfo.html" title="trait pallet_block_production_log::weights::WeightInfo">WeightInfo</a>;</code></div></li><li><div class="item-name"><code>pub use <a class="mod" href="pallet/index.html" title="mod pallet_block_production_log::pallet">pallet</a>::*;</code></div></li></ul><h2 id="modules" class="section-header">Modules<a href="#modules" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="mod" href="pallet/index.html" title="mod pallet_block_production_log::pallet">pallet</a></div><div class="desc docblock-short">The <code>pallet</code> module in each FRAME pallet hosts the most important items needed
to construct this pallet.</div></li><li><div class="item-name"><a class="mod" href="weights/index.html" title="mod pallet_block_production_log::weights">weights</a></div><div class="desc docblock-short">Autogenerated weights for pallet_block_production_log</div></li></ul></section></div></main></body></html>