<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Crate providing block participation data through the inherent data mechanism."><title>sp_block_participation - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-c5d6553a23f1e5a6.css"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="sp_block_participation" data-themes="" data-resource-suffix="" data-rustdoc-version="1.81.0 (eeb90cda1 2024-09-04)" data-channel="1.81.0" data-search-js="search-d234aafac6c221dd.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../static.files/storage-118b08c4c78b968e.js"></script><script defer src="../crates.js"></script><script defer src="../static.files/main-d2fab2bf619172d3.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-df360f571f6edeae.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../sp_block_participation/index.html">sp_block_participation</a><span class="version">1.6.0</span></h2></div><div class="sidebar-elems"><ul class="block"><li><a id="all-types" href="all.html">All Items</a></li></ul><section><ul class="block"><li><a href="#modules">Modules</a></li><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#constants">Constants</a></li><li><a href="#traits">Traits</a></li></ul></section></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><h1>Crate <a class="mod" href="#">sp_block_participation</a><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><span class="out-of-band"><a class="src" href="../src/sp_block_participation/lib.rs.html#1-441">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Crate providing block participation data through the inherent data mechanism.</p>
<h3 id="purpose-of-this-crate"><a class="doc-anchor" href="#purpose-of-this-crate">§</a>Purpose of this crate</h3>
<p>This crate provides logic to compute and expose as inherent data aggregated information on block producers’
and their delegators’ participation in block production. This feature is implemented in an unusual way in
that it publishes inherent data but leaves it to the specific Partner Chain’s builders to implement the pallet
that will consume this data. This is done because Partner Chains SDK can not anticipate how this data will
have to be handled within every Partner Chain. The assumed use of the data provided is paying out of block
production reward, however both ledger structure and reward calculation rules are inherently specific to
their Partner Chain.</p>
<h3 id="outline-of-operation"><a class="doc-anchor" href="#outline-of-operation">§</a>Outline of operation</h3>
<ol>
<li>The inhrent data provider calls runtime API to check whether it should release block participation inherent
data (all points below assume this check is positive) and gets the upper slot limit.</li>
<li>The inhrent data provider retrieves data on block production up to the slot limit using runtime API and Cardano
delegation data using observability data source. The IDP joins and aggregates this data together producing
block participation data.</li>
<li>The IDP puts the block participation data into the inherent data of the current block, under the inherent
identifier indicated by the runtime API. This inherent identifier belongs to the Partner Chain’s custom
handler crate.</li>
<li>The IDP produces an additional “operational” inherent data to signal its own pallet that participation data
has been released.</li>
<li>The Partner Chain’s custom handler pallet consumes the block participation inherent data and produces an
inherent that performs block rewards payouts or otherwise handles the data according to this particular
Partner Chain’s rules.</li>
<li>The block participation pallet consumes the operational inherent data and cleans up block production data
up to the slot limit.</li>
</ol>
<h3 id="usage"><a class="doc-anchor" href="#usage">§</a>Usage</h3>
<p>To incorporate this feature into a Partner Chain, one must do the following:</p>
<ol>
<li>Implement a pallet consuming inherent data of type <a href="struct.BlockProductionData.html" title="struct sp_block_participation::BlockProductionData">BlockProductionData</a></li>
<li>Include the block participation pallet into their runtime and configure it. Consult the documentation of
<code>pallet_block_participation</code> for details.</li>
<li>Implement <a href="trait.BlockParticipationApi.html" title="trait sp_block_participation::BlockParticipationApi">BlockParticipationApi</a> for their runtime.</li>
<li>Include <a href="inherent_data/enum.BlockParticipationInherentDataProvider.html" title="enum sp_block_participation::inherent_data::BlockParticipationInherentDataProvider">inherent_data::BlockParticipationInherentDataProvider</a> in their node’s inherent data
provider set for both proposal and verification of blocks.</li>
</ol>
<p>Configuring the pallet and implementing the runtime API requires there to be a source of block production data
present in the runtime that can be used by the feature. The intended source is <code>pallet_block_production_log</code> but
in principle anu pallet offering a similar interfaces can be used. An example of runtime API implementation using
the block participation log pallet looks like the following:</p>

<div class="example-wrap ignore"><a href="#" class="tooltip" title="This example is not tested">ⓘ</a><pre class="rust rust-example-rendered"><code><span class="kw">impl </span>sp_block_participation::BlockParticipationApi&lt;Block, BlockAuthor&gt; <span class="kw">for </span>Runtime {
	<span class="kw">fn </span>should_release_data(slot: Slot) -&gt; <span class="prelude-ty">Option</span>&lt;Slot&gt; {
		BlockParticipationPallet::should_release_data(slot)
	}
	<span class="kw">fn </span>blocks_produced_up_to_slot(slot: Slot) -&gt; Vec&lt;(Slot, BlockAuthor)&gt; {
		&lt;Runtime <span class="kw">as </span>pallet_block_participation::Config&gt;::blocks_produced_up_to_slot(slot).collect()
	}
	<span class="kw">fn </span>target_inherent_id() -&gt; InherentIdentifier {
		&lt;Runtime <span class="kw">as </span>pallet_block_participation::Config&gt;::TARGET_INHERENT_ID
	}
}</code></pre></div>
</div></details><h2 id="modules" class="section-header">Modules<a href="#modules" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="mod" href="inherent_data/index.html" title="mod sp_block_participation::inherent_data">inherent_data</a></div></li></ul><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.BlockProducerParticipationData.html" title="struct sp_block_participation::BlockProducerParticipationData">BlockProducerParticipationData</a></div><div class="desc docblock-short">Aggregated data on block production of one block producer in one aggregation period.</div></li><li><div class="item-name"><a class="struct" href="struct.BlockProductionData.html" title="struct sp_block_participation::BlockProductionData">BlockProductionData</a></div><div class="desc docblock-short">Aggregated data on block production, grouped by the block producer and aggregation period (main chain epoch).</div></li><li><div class="item-name"><a class="struct" href="struct.DelegatorBlockParticipationData.html" title="struct sp_block_participation::DelegatorBlockParticipationData">DelegatorBlockParticipationData</a></div><div class="desc docblock-short">Represents a block producer’s delegator along with their number of shares in that block producer’s pool.</div></li><li><div class="item-name"><a class="struct" href="struct.Slot.html" title="struct sp_block_participation::Slot">Slot</a></div><div class="desc docblock-short">Unit type wrapper that represents a slot.</div></li><li><div class="item-name"><a class="struct" href="struct.SlotDuration.html" title="struct sp_block_participation::SlotDuration">SlotDuration</a></div><div class="desc docblock-short">A slot duration defined in milliseconds.</div></li></ul><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.InherentError.html" title="enum sp_block_participation::InherentError">InherentError</a></div></li></ul><h2 id="constants" class="section-header">Constants<a href="#constants" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="constant" href="constant.INHERENT_IDENTIFIER.html" title="constant sp_block_participation::INHERENT_IDENTIFIER">INHERENT_IDENTIFIER</a></div></li></ul><h2 id="traits" class="section-header">Traits<a href="#traits" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="trait" href="trait.AsCardanoSPO.html" title="trait sp_block_participation::AsCardanoSPO">AsCardanoSPO</a></div><div class="desc docblock-short">Signifies that a type or some of its variants represents a Cardano stake pool operator</div></li><li><div class="item-name"><a class="trait" href="trait.BlockParticipationApi.html" title="trait sp_block_participation::BlockParticipationApi">BlockParticipationApi</a></div><div class="desc docblock-short">Runtime api exposing configuration and runtime bindings necessary for <a href="inherent_data/enum.BlockParticipationInherentDataProvider.html" title="enum sp_block_participation::inherent_data::BlockParticipationInherentDataProvider">inherent_data::BlockParticipationInherentDataProvider</a>.</div></li><li><div class="item-name"><a class="trait" href="trait.CardanoDelegator.html" title="trait sp_block_participation::CardanoDelegator">CardanoDelegator</a></div><div class="desc docblock-short">Signifies that a type represents a Cardano delegator</div></li></ul></section></div></main></body></html>